trigger:
- main

pool:
 name: DockerBuildAgents

steps:
- script: |
    docker --version
    echo Kill all running containers if existing
    docker container kill $(docker ps -q)
    echo Run unit and instrumented inside docker container
    docker run --privileged --cpus="3" --memory="12g" -v "$PWD":/home/gradle/ -w /home/gradle/ authclient.azurecr.io/samples/dbi-instrumented-api30 sh scripts/run-instrumented-tests.sh
  displayName: 'Build and test inside docker container'
- script: |
    echo dumping environment variables for build agent
    env
  displayName: 'Cleanup'
